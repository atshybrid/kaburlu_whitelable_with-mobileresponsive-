// Prisma schema for multi-tenant news website
// Default to SQLite for local development; supports PostgreSQL if DATABASE_URL is set accordingly

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite" // change to "postgresql" if you move to Postgres
  url      = env("DATABASE_URL")
}

model Tenant {
  id        String   @id @default(cuid())
  slug      String   @unique
  domain    String?  @unique
  name      String
  themeKey  String   @default("style1")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  categories Category[]
  authors    Author[]
  tags       Tag[]
  media      Media[]
  articles   Article[]
}

model Theme {
  key         String @id
  name        String
  description String?
}

model Category {
  id       String  @id @default(cuid())
  slug     String
  name     String
  tenant   Tenant  @relation(fields: [tenantId], references: [id])
  tenantId String

  articles ArticleCategory[]

  @@unique([tenantId, slug])
}

model Author {
  id       String  @id @default(cuid())
  name     String
  bio      String?
  avatarUrl String?
  tenant   Tenant  @relation(fields: [tenantId], references: [id])
  tenantId String

  articles Article[]
}

model Tag {
  id       String  @id @default(cuid())
  name     String
  tenant   Tenant  @relation(fields: [tenantId], references: [id])
  tenantId String

  articles ArticleTag[]

  @@unique([tenantId, name])
}

model Media {
  id       String  @id @default(cuid())
  url      String
  width    Int?
  height   Int?
  type     String?
  tenant   Tenant  @relation(fields: [tenantId], references: [id])
  tenantId String

  articles Article[] @relation("CoverImage")
}

model Article {
  id           String         @id @default(cuid())
  slug         String
  title        String
  excerpt      String?
  content      String
  status       String         @default("DRAFT")
  publishedAt  DateTime?
  tenant       Tenant         @relation(fields: [tenantId], references: [id])
  tenantId     String
  author       Author?        @relation(fields: [authorId], references: [id])
  authorId     String?
  coverImage   Media?         @relation("CoverImage", fields: [coverImageId], references: [id])
  coverImageId String?
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt

  categories ArticleCategory[]
  tags       ArticleTag[]

  @@unique([tenantId, slug])
}

model ArticleCategory {
  article   Article @relation(fields: [articleId], references: [id])
  articleId String
  category  Category @relation(fields: [categoryId], references: [id])
  categoryId String

  @@id([articleId, categoryId])
}

model ArticleTag {
  article   Article @relation(fields: [articleId], references: [id])
  articleId String
  tag       Tag @relation(fields: [tagId], references: [id])
  tagId     String

  @@id([articleId, tagId])
}
